<input type="file" id="imageInput" accept="image/*">
<img id="preview" style="max-width: 100%; display: none; margin: 10px 0; border: 1px solid #333;">

<script>
    const GITHUB_CONFIG = {
        token: "YOUR_ACTUAL_TOKEN_HERE", // Keep this strictly in this private file
        owner: "mayukh18052012-cell",
        repo: "sportsclusive",
        branch: "main" 
    };

    // Show image preview
    document.getElementById('imageInput').onchange = function(e) {
        const reader = new FileReader();
        reader.onload = function() {
            const img = document.getElementById('preview');
            img.src = reader.result;
            img.style.display = "block";
        }
        reader.readAsDataURL(e.target.files[0]);
    };

    async function sendToGithub() {
        const title = document.getElementById('title').value;
        const content = document.getElementById('body').value;
        const imageFile = document.getElementById('imageInput').files[0];
        const status = document.getElementById('status');

        if(!title || !content || !imageFile) { alert("Missing title, content, or image!"); return; }

        status.style.display = "block";
        status.innerText = "Uploading Image and Article...";

        const dateStr = new Date().toISOString().split('T')[0];
        const slug = title.toLowerCase().replace(/ /g, '-');
        
        try {
            // 1. UPLOAD IMAGE FIRST
            const imgReader = new FileReader();
            imgReader.readAsArrayBuffer(imageFile);
            imgReader.onload = async () => {
                const imgBase64 = btoa(String.fromCharCode(...new Uint8Array(imgReader.result)));
                const imgPath = `images/uploads/${dateStr}-${slug}.png`;

                await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${imgPath}`, {
                    method: 'PUT',
                    headers: { 'Authorization': `token ${GITHUB_CONFIG.token}` },
                    body: JSON.stringify({
                        message: `Upload image for ${title}`,
                        content: imgBase64
                    })
                });

                // 2. UPLOAD ARTICLE MARKDOWN
                const postPath = `_posts/${dateStr}-${slug}.md`;
                const postContent = `---
title: "${title}"
image: "/${imgPath}"
date: "${dateStr}"
---
${content}`;
                const postBase64 = btoa(unescape(encodeURIComponent(postContent)));

                const res = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${postPath}`, {
                    method: 'PUT',
                    headers: { 'Authorization': `token ${GITHUB_CONFIG.token}` },
                    body: JSON.stringify({
                        message: `New Post: ${title}`,
                        content: postBase64
                    })
                });

                if(res.ok) {
                    status.innerText = "SUCCESS! Article and Image are live.";
                    status.style.background = "green";
                }
            };
        } catch (err) {
            status.innerText = "Upload failed. Check token permissions.";
        }
    }
</script>
