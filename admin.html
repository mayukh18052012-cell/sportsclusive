<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ESPN Admin | Manual Post</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .admin-form { max-width: 800px; margin: 50px auto; background: #111; padding: 30px; border-top: 5px solid #ff002b; }
        input, textarea { width: 100%; padding: 12px; margin: 10px 0; background: #222; border: 1px solid #333; color: white; }
        button { background: #ff002b; color: white; border: none; padding: 15px 30px; cursor: pointer; font-weight: bold; width: 100%; }
        .preview-img { max-width: 200px; display: block; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="admin-form">
        <h2 style="font-family: 'Oswald';">CREATE NEW ARTICLE</h2>
        
        <input type="password" id="ghToken" placeholder="GitHub Personal Access Token">
        <input type="text" id="postTitle" placeholder="Article Title (e.g. Messi Scores Twice)">
        <input type="file" id="postImage" accept="image/*">
        <img id="imgPreview" class="preview-img" src="">
        <textarea id="postContent" rows="10" placeholder="Write your article here... (Markdown supported)"></textarea>
        
        <button onclick="publishToGithub()">PUBLISH TO GITHUB</button>
        <p id="status"></p>
    </div>

    <script>
        // Preview Image locally
        document.getElementById('postImage').onchange = function(evt) {
            const [file] = this.files;
            if (file) document.getElementById('imgPreview').src = URL.createObjectURL(file);
        };

        async function publishToGithub() {
            const token = document.getElementById('ghToken').value;
            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').value;
            const fileInput = document.getElementById('postImage');
            const status = document.getElementById('status');

            if (!token || !title) return alert("Token and Title are required!");

            const fileName = title.toLowerCase().replace(/ /g, '-') + '.md';
            const owner = "YOUR_GITHUB_USERNAME"; // <-- CHANGE THIS
            const repo = "YOUR_REPO_NAME";        // <-- CHANGE THIS
            const path = `_posts/${fileName}`;

            // Convert content to Base64 (GitHub API Requirement)
            const base64Content = btoa(unescape(encodeURIComponent(`---\ntitle: ${title}\ndate: ${new Date().toISOString()}\n---\n\n${content}`)));

            status.innerText = "Publishing... please wait.";

            try {
                const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: `New article: ${title}`,
                        content: base64Content
                    })
                });

                if (response.ok) {
                    status.style.color = "lime";
                    status.innerText = "SUCCESS! Article pushed to GitHub.";
                } else {
                    const err = await response.json();
                    status.innerText = "Error: " + err.message;
                }
            } catch (e) {
                status.innerText = "Connection failed.";
            }
        }
    </script>
</body>
</html>
